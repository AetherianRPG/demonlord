{"_id":"6PMGvBHfkWXTsLJV","name":"Request Challenge Roll","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{},"scope":"global","command":"// GM Tool\n// Lets you request a challenge roll from the select tokens. Each token owner gets a whisper message asking them to make a roll.\n\nfunction requestRoll(token, attribute, boonsbanes) {\n    const actor = token.actor;\n    let users = game.users.filter(user => user.active);\n\n    var targets = [];\n    for (let user of users) {\n        if (actor.data.permission[user.id])\n            targets.push(user.id);\n    }\n\n    let boonsbanestext = \"\";\n    if (boonsbanes == 1)\n        boonsbanestext = boonsbanes + \" \" + game.i18n.localize('DL.DialogBoon');\n    if (boonsbanes > 1)\n        boonsbanestext = boonsbanes + \" \" + game.i18n.localize('DL.DialogBoons');\n    if (boonsbanes == -1)\n        boonsbanestext = boonsbanes.replace(\"-\", \"\") + \" \" + game.i18n.localize('DL.DialogBane');\n    if (boonsbanes < -1)\n        boonsbanestext = boonsbanes.replace(\"-\", \"\") + \" \" + game.i18n.localize('DL.DialogBanes');\n\n    var templateData = {\n        actor: actor,\n        data: {\n            attribute: {\n                value: CONFIG.DL.attributes[attribute.toLowerCase()]\n            },\n            boonsbanes: {\n                value: boonsbanes\n            },\n            boonsbanestext: {\n                value: boonsbanestext\n            }\n        }\n    };\n\n    let chatData = {\n        user: targets[0],\n        speaker: {\n            actor: actor._id,\n            token: actor.token,\n            alias: actor.name\n        }\n    };\n\n    chatData[\"whisper\"] = targets;\n\n    let template = 'systems/demonlord/templates/chat/makechallengeroll.html';\n    renderTemplate(template, templateData).then(content => {\n        chatData.content = content;\n        ChatMessage.create(chatData);\n    });\n}\n\nlet applyChanges = false;\nnew Dialog({\n    title: game.i18n.localize('DL.MacroChallengeTitle'),\n    content: `\n    <form>\n      <div class=\"form-group\">\n        <label>` + game.i18n.localize('DL.MacroChallengeChoose') + `</label>\n        <select id=\"attribute-type\" name=\"attribute-type\">\n          <option value=\"Strength\">` + game.i18n.localize('DL.AttributeStrength') + `</option>\n          <option value=\"Agility\">` + game.i18n.localize('DL.AttributeAgility') + `</option>\n          <option value=\"Intellect\">` + game.i18n.localize('DL.AttributeIntellect') + `</option>\n          <option value=\"Will\">` + game.i18n.localize('DL.AttributeWill') + `</option>\n          <option value=\"Perception\">` + game.i18n.localize('DL.CharPerception') + `</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label>` + game.i18n.localize('DL.WeaponBoonsBanes') + `:</label>\n        <input type=\"text\" name=\"boonsbanes\" value=\"0\"/>\n      </div>\n    </form>\n    `,\n    buttons: {\n        yes: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: game.i18n.localize('DL.MacroChallengeRequestRoll'),\n            callback: () => applyChanges = true\n        },\n        no: {\n            icon: \"<i class='fas fa-times'></i>\",\n            label: game.i18n.localize('DL.MacroCancel')\n        },\n    },\n    default: \"yes\",\n    close: html => {\n        if (applyChanges) {\n            for (let token of canvas.tokens.controlled) {\n                let attribute = html.find('[name=\"attribute-type\"]')[0].value || \"none\";\n                let boonsbanes = html.find('[name=\"boonsbanes\"]')[0].value || \"none\";\n\n                requestRoll(token, attribute, boonsbanes);\n            }\n        }\n    }\n}).render(true);","author":"Sd8TaawsSgOTEPU7","img":"systems/demonlord/icons/skills/challenge.png","actorIds":[]}
{"name":"Apply Afflictions Macro","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{"core":{"sourceId":"Macro.J2a9ZtLSSJhH5WjH"}},"scope":"global","command":"// GM Tool\n// Lets you apply Afflictions to all selected tokens.\n\nasync function setTokenEffects(actor) {\n    const asleep = CONFIG.DL.statusIcons.asleep;\n    const blinded = CONFIG.DL.statusIcons.blinded;\n    const dazed = CONFIG.DL.statusIcons.dazed;\n    const deafened = CONFIG.DL.statusIcons.deafened;\n    const frightened = CONFIG.DL.statusIcons.frightened;\n    const poisoned = CONFIG.DL.statusIcons.poisoned;\n    const prone = CONFIG.DL.statusIcons.prone;\n    const unconscious = CONFIG.DL.statusIcons.unconscious;\n\n    const actorData = actor.data;\n\n    for (const t of actor.getActiveTokens()) {\n        if (t.data.actorLink && t.scene.id === game.scenes.active.id) {\n            if (actorData.data.afflictions.asleep &&\n                !t.data.effects.includes(asleep))\n                await t.toggleEffect(asleep);\n            else if (!actorData.data.afflictions.asleep &&\n                t.data.effects.includes(asleep))\n                await t.toggleEffect(asleep);\n            if (actorData.data.afflictions.blinded &&\n                !t.data.effects.includes(blinded))\n                await t.toggleEffect(blinded);\n            else if (!actorData.data.afflictions.blinded &&\n                t.data.effects.includes(blinded))\n                await t.toggleEffect(blinded);\n            if (actorData.data.afflictions.dazed &&\n                !t.data.effects.includes(dazed))\n                await t.toggleEffect(dazed);\n            else if (!actorData.data.afflictions.dazed &&\n                t.data.effects.includes(dazed))\n                await t.toggleEffect(dazed);\n            if (actorData.data.afflictions.deafened &&\n                !t.data.effects.includes(deafened))\n                await t.toggleEffect(deafened);\n            else if (!actorData.data.afflictions.deafened &&\n                t.data.effects.includes(deafened))\n                await t.toggleEffect(deafened);\n            if (actorData.data.afflictions.frightened &&\n                !t.data.effects.includes(frightened))\n                await t.toggleEffect(frightened);\n            else if (!actorData.data.afflictions.frightened &&\n                t.data.effects.includes(frightened))\n                await t.toggleEffect(frightened);\n            if (actorData.data.afflictions.poisoned &&\n                !t.data.effects.includes(poisoned))\n                await t.toggleEffect(poisoned);\n            else if (!actorData.data.afflictions.poisoned &&\n                t.data.effects.includes(poisoned))\n                await t.toggleEffect(poisoned);\n            if (actorData.data.afflictions.prone &&\n                !t.data.effects.includes(prone))\n                await t.toggleEffect(prone);\n            else if (!actorData.data.afflictions.prone &&\n                t.data.effects.includes(prone))\n                await t.toggleEffect(prone);\n            if (actorData.data.afflictions.unconscious &&\n                !t.data.effects.includes(unconscious))\n                await t.toggleEffect(unconscious);\n            else if (!actorData.data.afflictions.unconscious &&\n                t.data.effects.includes(unconscious))\n                await t.toggleEffect(unconscious);\n        }\n    }\n}\n\nlet applyChanges = false;\nnew Dialog({\n    title: game.i18n.localize('DL.MacroApplyAfflicationTitle'),\n    content: `\n    <form>\n      <div class=\"form-block\">\n        <ol class=\"items-list\">\n            <li>\n                <div class=\"grid grid-3col\">\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.asleep\" id=\"data.afflictions.asleep\">\n                        <div class=\"tooltip\">\n                            <label for=\"data.afflictions.asleep\">\n                                Asleep\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A sleeping creature is prone and unconscious. Another creature that can reach it can use an action to wake it up. Unless otherwise noted, taking damage removes this affliction.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.blinded\" id=\"data.afflictions.blinded\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.blinded\">\n                                Blinded\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A blinded creature cannot see. It treats its surroundings as totally obscured (see Obscurement). Other creatures make attack rolls with 1 boon against a blinded creature’s Defense or Agility. Perception challenge rolls that rely on sight automatically result in failure. Finally, the blinded creature’s Speed becomes 2 unless its normal Speed is lower.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.charmed\" id=\"data.afflictions.charmed\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.charmed\">\n                                Charmed\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A charmed creature sees the source of the affliction as a trusted friend and ally. The charmed creature cannot choose the creature that bestowed the affliction as the target of its attacks.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.compelled\" id=\"actor.data.afflictions.compelled\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.compelled\">\n                                Compelled\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A compelled creature cannot use actions or move. Instead, during each fast turn (see Combat), the creature that bestowed the affliction can force the compelled creature to move up to its Speed or to use an action. The creature that bestowed the affliction makes all decisions on the compelled creature’s behalf.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.dazed\" id=\"data.afflictions.dazed\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.dazed\">\n                                Dazed\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A dazed creature cannot use actions.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.deafened\" id=\"data.afflictions.deafened\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.deafened\">\n                                Deafened\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A deafened creature cannot hear. Perception challenge rolls made to listen automatically result in failure.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.defenseless\" id=\"data.afflictions.defenseless\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.defenseless\">\n                                Defenseless\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A defenseless creature cannot defend itself. Its Defense is 5, it cannot use actions, and its challenge rolls using attributes result in failure. The creature can still perceive its surroundings, however, and can make Perception challenge rolls as normal.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.diseased\" id=\"data.afflictions.diseased\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.diseased\">\n                                Diseased\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A diseased creature makes all attack rolls and challenge rolls with 1 bane.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.fatigued\" id=\"data.afflictions.fatigued\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.fatigued\">\n                                Fatigued\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A fatigued creature makes all attack rolls and challenge rolls with 1 bane.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.frightened\" id=\"data.afflictions.frightened\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.frightened\">\n                                Frightened\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A frightened creature makes attack rolls and challenge rolls with 1 bane or 3 banes when it can see the source of the frightened affliction.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.grabbed\" id=\"data.afflictions.grabbed\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.grabbed\">\n                                Grabbed\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">The effects of the affliction depend on the creature’s Size. If the grabbed creature’s Size is equal to or smaller than that of the creature grabbing it, the grabbed creature cannot move away from the creature that grabbed it until it removes the affliction. If the grabbed creature’s Size is larger than that of the creature grabbing it, whenever the grabbed creature moves, the creature grabbing it can choose to move with it (by clinging to the grabbed creature’s body) or end the grab. (See Grab for more information on how to grab, and Escape for how to escape a grab.)</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.immobilized\" id=\"data.afflictions.immobilized\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.immobilized\">\n                                Immobilized\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">An immobilized creature has Speed 0 and cannot benefit from bonuses to Speed. Other creatures make all attack rolls against the immobilized creature with 1 boon.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.impaired\" id=\"data.afflictions.impaired\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.impaired\">\n                                Impaired\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">An impaired creature makes all attack rolls and challenge rolls with 1 bane.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.poisoned\" id=\"data.afflictions.poisoned\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.poisoned\">\n                                Poisoned\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A poisoned creature makes all attack rolls and challenge rolls with 1 bane.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.prone\" id=\"data.afflictions.prone\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.prone\">\n                                Prone\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A prone creature lies on the ground. Other creatures can move through its space. While prone, the creature can move by crawling or can use its move to stand up. The prone creature makes Strength and Agility rolls with 1 bane. Creatures that can reach the prone creature make all attack rolls against it with 1 boon, while creatures that cannot reach it make attack rolls against its Defense with 1 bane.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.slowed\" id=\"data.afflictions.slowed\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.slowed\">\n                                Slowed\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A slowed creature can take only a slow turn (see Combat), its Speed is halved, and it cannot benefit from increases to Speed.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.stunned\" id=\"data.afflictions.stunned\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.stunned\">\n                                Stunned\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A stunned creature cannot move or use actions. The creature automatically gets a failure on any challenge rolls it would make. Other creatures make all attack rolls against the stunned creature with 1 boon.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.surprised\" id=\"data.afflictions.surprised\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.surprised\">\n                                Surprised\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A surprised creature cannot use actions, cannot move, and automatically gets a failure on any challenge rolls it would make.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.unconscious\" id=\"data.afflictions.unconscious\">\n                        <div class=\"tooltip\">\n                            <label for=\"actor.data.afflictions.unconscious\">\n                                Unconscious\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">An unconscious creature is unable to act, move, or perceive its surroundings. The creature’s Defense is 5. It cannot use actions or move, and all its challenge rolls result in failure.</span>\n                        </div>\n                    </div>\n                </div>\n            </li>\n        </ol>\n    </div>\n    </form>\n    `,\n    buttons: {\n        yes: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: game.i18n.localize('DL.MacroApplyAfflicationTitle'),\n            callback: () => applyChanges = true\n        },\n        no: {\n            icon: \"<i class='fas fa-times'></i>\",\n            label: game.i18n.localize('DL.MacroCancel')\n        },\n    },\n    default: \"yes\",\n    close: html => {\n        if (applyChanges) {\n            for (let token of canvas.tokens.controlled) {\n                if (html.find('[name=\"actor.data.afflictions.asleep\"]')[0].checked) {\n                    token.actor.data.data.afflictions.asleep = true;\n                    token.actor.data.data.afflictions.prone = true;\n                    token.actor.data.data.afflictions.unconscious = true;\n                }\n                if (html.find('[name=\"actor.data.afflictions.blinded\"]')[0].checked)\n                    token.actor.data.data.afflictions.blinded = true;\n                if (html.find('[name=\"actor.data.afflictions.charmed\"]')[0].checked)\n                    token.actor.data.data.afflictions.charmed = true;\n                if (html.find('[name=\"actor.data.afflictions.compelled\"]')[0].checked)\n                    token.actor.data.data.afflictions.compelled = true;\n                if (html.find('[name=\"actor.data.afflictions.dazed\"]')[0].checked)\n                    token.actor.data.data.afflictions.dazed = true;\n                if (html.find('[name=\"actor.data.afflictions.deafened\"]')[0].checked)\n                    token.actor.data.data.afflictions.deafened = true;\n                if (html.find('[name=\"actor.data.afflictions.defenseless\"]')[0].checked)\n                    token.actor.data.data.afflictions.defenseless = true;\n                if (html.find('[name=\"actor.data.afflictions.diseased\"]')[0].checked)\n                    token.actor.data.data.afflictions.diseased = true;\n                if (html.find('[name=\"actor.data.afflictions.fatigued\"]')[0].checked)\n                    token.actor.data.data.afflictions.fatigued = true;\n                if (html.find('[name=\"actor.data.afflictions.frightened\"]')[0].checked)\n                    token.actor.data.data.afflictions.frightened = true;\n                if (html.find('[name=\"actor.data.afflictions.grabbed\"]')[0].checked)\n                    token.actor.data.data.afflictions.grabbed = true;\n                if (html.find('[name=\"actor.data.afflictions.immobilized\"]')[0].checked)\n                    token.actor.data.data.afflictions.immobilized = true;\n                if (html.find('[name=\"actor.data.afflictions.impaired\"]')[0].checked)\n                    token.actor.data.data.afflictions.impaired = true;\n                if (html.find('[name=\"actor.data.afflictions.poisoned\"]')[0].checked)\n                    token.actor.data.data.afflictions.poisoned = true;\n                if (html.find('[name=\"actor.data.afflictions.prone\"]')[0].checked)\n                    token.actor.data.data.afflictions.prone = true;\n                if (html.find('[name=\"actor.data.afflictions.slowed\"]')[0].checked) {\n                    token.actor.data.data.afflictions.slowed = true;\n                    token.actor.data.data.fastturn = false;\n                }\n                if (html.find('[name=\"actor.data.afflictions.stunned\"]')[0].checked)\n                    token.actor.data.data.afflictions.stunned = true;\n                if (html.find('[name=\"actor.data.afflictions.surprised\"]')[0].checked)\n                    token.actor.data.data.afflictions.surprised = true;\n                if (html.find('[name=\"actor.data.afflictions.unconscious\"]')[0].checked)\n                    token.actor.data.data.afflictions.unconscious = true;\n\n                setTokenEffects(token.actor);\n            }\n        }\n    }\n}).render(true);","author":"Sd8TaawsSgOTEPU7","img":"systems/demonlord/icons/skills/heart.png","actorIds":[],"_id":"8LqjRfeT0dRCoIq4"}
{"_id":"m3RJhHOGDUTIQkuU","name":"Request Initiative Roll","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{},"scope":"global","command":"// GM Tool\n// Lets you request a Initiative Roll from the selected tokens. Each token owner gets a whisper message asking them to make a roll.\n\nfunction requestInitRoll(token) {\n    const actor = token.actor;\n    let users = game.users.filter(user => user.active);\n\n    var targets = [];\n    for (let user of users) {\n        if (actor.data.permission[user.id])\n            targets.push(user.id);\n    }\n\n    var templateData = {\n        actor: actor\n    };\n\n    let chatData = {\n        user: targets[0],\n        speaker: {\n            actor: actor._id,\n            token: actor.token,\n            alias: actor.name\n        }\n    };\n\n    chatData[\"whisper\"] = targets;\n\n    let template = 'systems/demonlord/templates/chat/makeinitroll.html';\n    renderTemplate(template, templateData).then(content => {\n        chatData.content = content;\n        ChatMessage.create(chatData);\n    });\n}\n\nfor (let token of canvas.tokens.controlled) {\n    requestInitRoll(token);\n}","author":"Sd8TaawsSgOTEPU7","img":"icons/svg/d20.svg","actorIds":[]}
