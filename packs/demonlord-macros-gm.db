{"_id":"6PMGvBHfkWXTsLJV","name":"Request Challenge Roll","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{},"scope":"global","command":"// GM Tool\r\n// Lets you request a challenge roll from the select tokens. Each token owner gets a whisper message asking them to make a roll.\r\n\r\nfunction requestRoll(token, attribute, boonsbanes) {\r\n    const actor = token.actor;\r\n    let users = game.users.filter(user => user.active);\r\n\r\n    var targets = [];\r\n    for (let user of users) {\r\n        if (actor.data.permission[user.id])\r\n            targets.push(user.id);\r\n    }\r\n\r\n    let boonsbanestext = \"\";\r\n    if (boonsbanes == 1)\r\n        boonsbanestext = boonsbanes + \" \" + game.i18n.localize('DL.DialogBoon');\r\n    if (boonsbanes > 1)\r\n        boonsbanestext = boonsbanes + \" \" + game.i18n.localize('DL.DialogBoons');\r\n    if (boonsbanes == -1)\r\n        boonsbanestext = boonsbanes.replace(\"-\", \"\") + \" \" + game.i18n.localize('DL.DialogBane');\r\n    if (boonsbanes < -1)\r\n        boonsbanestext = boonsbanes.replace(\"-\", \"\") + \" \" + game.i18n.localize('DL.DialogBanes');\r\n\r\n    var templateData = {\r\n        actor: actor,\r\n        data: {\r\n            attribute: {\r\n                value: attribute\r\n            },\r\n            boonsbanes: {\r\n                value: boonsbanes\r\n            },\r\n            boonsbanestext: {\r\n                value: boonsbanestext\r\n            }\r\n        }\r\n    };\r\n\r\n    let chatData = {\r\n        user: targets[0],\r\n        speaker: {\r\n            actor: actor._id,\r\n            token: actor.token,\r\n            alias: actor.name\r\n        }\r\n    };\r\n\r\n    chatData[\"whisper\"] = targets;\r\n\r\n    let template = 'systems/demonlord/templates/chat/makechallengeroll.html';\r\n    renderTemplate(template, templateData).then(content => {\r\n        chatData.content = content;\r\n        ChatMessage.create(chatData);\r\n    });\r\n}\r\n\r\nlet applyChanges = false;\r\nnew Dialog({\r\n    title: `Request Challenge Roll`,\r\n    content: `\r\n    <form>\r\n      <div class=\"form-group\">\r\n        <label>Choose Attribute:</label>\r\n        <select id=\"attribute-type\" name=\"attribute-type\">\r\n          <option value=\"Strength\">Strength</option>\r\n          <option value=\"Agility\">Agility</option>\r\n          <option value=\"Intellect\">Intellect</option>\r\n          <option value=\"Will\">Will</option>\r\n          <option value=\"Perception\">Perception</option>\r\n        </select>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Boons/Banes:</label>\r\n        <input type=\"text\" name=\"boonsbanes\" value=\"0\"/>\r\n      </div>\r\n    </form>\r\n    `,\r\n    buttons: {\r\n        yes: {\r\n            icon: \"<i class='fas fa-check'></i>\",\r\n            label: `Request Roll`,\r\n            callback: () => applyChanges = true\r\n        },\r\n        no: {\r\n            icon: \"<i class='fas fa-times'></i>\",\r\n            label: `Cancel`\r\n        },\r\n    },\r\n    default: \"yes\",\r\n    close: html => {\r\n        if (applyChanges) {\r\n            for (let token of canvas.tokens.controlled) {\r\n                let attribute = html.find('[name=\"attribute-type\"]')[0].value || \"none\";\r\n                let boonsbanes = html.find('[name=\"boonsbanes\"]')[0].value || \"none\";\r\n\r\n                requestRoll(token, attribute, boonsbanes);\r\n            }\r\n        }\r\n    }\r\n}).render(true);","author":"Sd8TaawsSgOTEPU7","img":"systems/demonlord/icons/skills/challenge.png","actorIds":[]}
{"name":"Request Initiative Roll","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{},"scope":"global","command":"// GM Tool\r\n// Lets you request a Initiative Roll from the selected tokens. Each token owner gets a whisper message asking them to make a roll.\r\n\r\nfunction requestInitRoll(token) {\r\n    const actor = token.actor;\r\n    let users = game.users.filter(user => user.active);\r\n\r\n    var targets = [];\r\n    for (let user of users) {\r\n        if (actor.data.permission[user.id])\r\n            targets.push(user.id);\r\n    }\r\n\r\n    var templateData = {\r\n        actor: actor\r\n    };\r\n\r\n    let chatData = {\r\n        user: targets[0],\r\n        speaker: {\r\n            actor: actor._id,\r\n            token: actor.token,\r\n            alias: actor.name\r\n        }\r\n    };\r\n\r\n    chatData[\"whisper\"] = targets;\r\n\r\n    let template = 'systems/demonlord/templates/chat/makeinitroll.html';\r\n    renderTemplate(template, templateData).then(content => {\r\n        chatData.content = content;\r\n        ChatMessage.create(chatData);\r\n    });\r\n}\r\n\r\nfor (let token of canvas.tokens.controlled) {\r\n    requestInitRoll(token);\r\n}","author":"Sd8TaawsSgOTEPU7","img":"icons/svg/d20.svg","actorIds":[],"_id":"m3RJhHOGDUTIQkuU"}
